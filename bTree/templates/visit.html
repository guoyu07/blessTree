<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="format-detection" content="telephone=no" />
    <title>{{ owner }}的空间</title>

    <!--CSS-->
    {% load staticfiles %}
    <link rel="stylesheet" type="text/css" href="{% static "tree/css/visit.css" %}">

    <link rel="stylesheet" type="text/css" href="{% static "plugin/weui/weui.min.css" %}">
    <link href="//cdn.bootcss.com/pure/0.6.0/pure-min.css" rel="stylesheet">
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-min.css">

    <!--js-->
    <script src="{% static "plugin/jquery/jquery.min.js" %}"></script>
    <script src="{% static "plugin/jquery/jquery.color.js" %}"></script>
    <script src="{% static "plugin/jquery/jquery.mobile-events.min.js" %}"></script>
    <script src="{% static "tree/js/jquery.lqc.extension.js" %}"></script>
    <script src="{% static "tree/js/visit.js" %}"></script>


</head>
<body class="my-body">
{% if error %}
    <p>我知道这是你最讨厌的页面404～～，赶紧邀请他参加吧～～</p>
{% else %}
<!--顶部-->
<div class="menu-top">
    <div class="menu-top-con">
        <!--头像-->
        <div class="self-avatar">
            <a><img class="avatar" src="{{ avatar }}" style="width: inherit"></a>
        </div>
        <!--积分条-->
        <div class="count-progress">
            <div class="progress">
                <span class="progress-bar"><span class="progress-in" id="progress-in"></span></span>
            </div>
            <div class="count-num"><p>积分：{{ count }}</p></div>
        </div>
        <!--历史-->
        <div class="history">
            <a id="history"><img class="history-btn" src="{% static "tree/image/btn/history.png" %}"></a>
        </div>
        <!--我的主页-->
        <div class="zone" id="zone">
            <a ><img class="zone-btn" id="zone-btn" src="{% static "tree/image/btn/zone.png" %}" ></a>
        </div>
    </div>
</div>

<!--内容-->
<div class="main-container">
    <!--上面两个菜单-->
    <div class="main-top">
        <div class="willing">
            <a id="willing"><img class="willing-btn" src="{% static "tree/image/btn/willing.png" %}" style="width: inherit"></a>
        </div>
        <div class="water-flower">
            <a id="water-flower"><img class="water-btn" src="{% static "tree/image/btn/water.png" %}" style="width: inherit"></a>
        </div>
    </div>
    <div class="main-area">
        <!--树木区域-->
        <div class="main-tree pure-u-19-24" style="float: left;">
            <div class="tree-area"><img src="{% static "tree/image/others/tree.png" %}"></div>
            <div class="tree-name">
                <img src="{% static "tree/image/others/name.png" %}">
                <p class="name" style="margin-top: 19%;margin-left: 23%;">{{ tree_name }}</p>
            </div>
        </div>
        <div class="main-right pure-u-5-24" style="float:left">
            <ul class="right-btn" style="list-style-type: none">
                <!--吐槽-->
                <li id="tucao-btn"><img class="tucao" src="{% static "tree/image/btn/tucao.png" %}" style="width: 74%"></li>
                <!--祝福-->
                <li id="bless-btn"><img class="bless" src="{% static "tree/image/btn/bless.png" %}" style="width: 74%"></li>
            </ul>
        </div>
    </div>
</div>

<!--脚本-->
<div class="footer"></div>

<!--begin 小部件-->
<!--mask-->
<!--祝福与吐槽-->
<div class="tucao-widget" id="tucao-widget" style="display: none">
    <div class="tucao-widget-top">
        <img src="{% static "tree/image/btn/tucao.png" %}">
        <p>吐槽</p>
{#        <a class="tucao-close" id="tucao-close">X</a>#}
    </div>
    <div class="tucao-form-con">
        <div class="tucao-form">
            <textarea id="tucao-area" style="font-size: small" placeholder="我知道你想骂我很久了，没关系，让暴风雨来得更猛烈些吧"></textarea>
            <label style="display: block;"><input id="tucao-na" name="na" type="checkbox" value="" />匿名 </label>
            <a id="rand_tucao_1" style="font-size: 80%"></a><a id="rand_tucao_2" style="font-size: 80%"></a>
            <button class="tucao-confirm" id="tucao_confirm">确定</button>
        </div>
    </div>
</div>

<div class="bless-widget" id="bless-widget" style="display: none;">
    <div class="bless-widget-top">
        <img src="{% static "tree/image/btn/bless.png" %}">
        <p>祝福</p>
{#        <a class="bless-close" id="bless-close">X</a>#}
    </div>
    <div class="bless-form-con">
        <div class="bless-form">
            <textarea id="bless-area" style="font-size: small" placeholder="我知道你很欣赏我，我也很欣赏你的诚实"></textarea>
            <label style="display: block"><input id="bless-na" name="na" type="checkbox" value="" />匿名 </label>
            <a id='rand_bless_1' style="font-size: 80%"></a><a id="rand_bless_2" style="font-size: 80%"></a>
            <button id="bless_confirm" class="bless-confirm">确定</button>
        </div>
    </div>
</div>
    <!--浇水图片样例-->
<div class="water-widget" id="water-widget" style="display: none;width: 30%;position: fixed;
    z-index: 13;
    width: 25%;
    left: 50%;
    height: auto;
    top: 50%;">
    <img src="{% static "tree/image/others/water-tree.png" %}" style="width: 100%;height: auto">
</div>
<!--浇水提醒-->
<div class="water-tips" id="water-tips" style="display: none;">
    <p>点击<img src="{% static "tree/image/btn/water.png" %}">&nbsp&nbsp给小树苗浇水，可以帮助它长成大树哦</p>
    <button class="water-tips-btn">去浇水<img src="{% static "tree/image/btn/goto.png" %}"></button>
</div>
<!--浇水成功-->
<div class="water-success" id="water-success" style="display: none;">
    <p>浇水成功，不愧是我的真爱粉～~\(≧▽≦)/~</p>
    <button>我知道啦</button>
</div>
<div class="overlay" id="black-mask" style="display: none;position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,.3);"></div>
{% endif %}
</body>
<script>
    {% if error %}
    $(function () {
        alert("调皮～该用户尚未种树，不能访问哟～～")
    })
    {% else %}
    $(function () {
        alert("cg")
        //进度条宽度百分比设置
        $("#progress-in").css("width", "{{ count }}%");
{##}
        //我的主页
        $("#zone").on('tap', function () {
            alert('click success')
            window.open("{{ my_zone_url|safe }}")
        })

        //发送ajax
         $('#tucao_confirm').on('tap', function () {
             var tucao_con = $('#tucao-area').val();
             var na = $("#tucao-na").is(':checked') //是否匿名
             var source_id = "{{ flip_id }}"  //这个是发送消息的id，也就是谁浇水的


        })
        $('#bless_confirm').on('tap', function () {
            var bless_con = $('#bless-area').val();
            var na = $("#bless-na").is(':checked') //是否匿名
            if(na==true){
                var source_id = "na"
            }else{
                var source_id = "{{ flip_id }}"  //这个是发送消息的id，也就是谁祝福的
            }
            var openid = "{{ sourceid }}"  //这个sourceid是谁的主页的id
            $.ajax({
                url: 'http://1.blesstree.sinaapp.com/wechat/ajax',
                type: 'POST',
                timeout: 10000,
                dataType: 'json',
                async:false,  //不能异步去传输，否则有些数据就没有了
                encoding:'utf-8',
                data:{
                    'ajax_type' : '9',
                    'openid' : openid,
                    'source_id': source_id,
                    'bless_con' : bless_con
                },
                beforeSend: function () {
                    alert(na+source_id+openid+bless_con)
                }, //加载执行方法
                error: function () {
                    alert('您的网络似乎不稳定，请重新尝试一下哦～')
                },  //错误执行方法
                success: function (ret) {
                    if(ret == '1'){
                        alert('您的祝福对方已经收到啦～')
                    }else if(ret == '2'){
                        alert('不能提交空白祝福哦～')
                    }else{
                        alert(ret[1].name+ret[0].name+ret[2].name)
{#                        alert('似乎遇到了小菌也未曾遇到的问题呢～')#}
                    }
                    $("#black-mask").hide()
                    $("#bless-widget").hide();
                }
            })

        })


        /****************
     * 按钮逻辑
     * */
    //历史按钮
    $("#history").on('tap', function () {

    })


    //浇水按钮
    $("#water-flower").on('tap', function () {
        $("#water-")
    })

    //吐槽
    $("#tucao-btn").on('tap', function () {
        $("#tucao-widget").show();
        $("#black-mask").show()
                .on('tap', function () {
                    $("#tucao-widget").hide()
                    $("#black-mask").hide()
                })
    })
    //$("#tucao-close").on('tap', function () {
    //    $("tucao-widget").hide();
    //})

    $("#rand_tucao_1").on('tap', function () {
        $("#tucao-area").val($('#rand_tucao_1').text())
    })
    $('#rand_tucao_2').on('tap', function () {
        $("#tucao-area").val($('#rand_tucao_2').text())
    })
    //祝福
    $("#bless-btn").on('tap', function () {
        $("#black-mask").show()
                .on('tap', function () {
                    $("#bless-widget").hide()
                    $("#black-mask").hide()
                })
        $("#bless-widget").show();
    })

    //$("#bless-close").on('tap', function () {
    //    $("#bless-widget").hide();
    //})

    $("#rand_bless_1").on('tap', function () {
        $("#bless-area").val($('#rand_bless_1').text())
    })
    $('#rand_bless_2').on('tap', function () {
        $("#bless-area").val($('#rand_bless_2').text())
    })

    })
    {% endif %}
</script>
</html>